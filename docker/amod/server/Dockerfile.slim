FROM python:3-slim

RUN apt-get update -y && \
    apt-get install -yq --no-install-recommends \
         build-essential \
         libgl1-mesa-dri \
         git \
         xvfb \
         freeglut3-dev && \
     rm -rf /var/lib/apt/lists/*

RUN pip install Cython numpy pyyaml scipy pyglet opencv-python scikit-image gym

WORKDIR /workspace
RUN chmod -R a+w /workspace

ADD . gym-duckietown
RUN pip install -e gym-duckietown

RUN pip install -e git+https://github.com/duckietown/duckietown-slimremote.git#egg=duckietown-slimremote

COPY docker/amod/server/launch-gym-server-with-xvfb.sh /usr/bin/launch-gym-server-with-xvfb

EXPOSE 5558 8902

CMD launch-gym-server-with-xvfb
